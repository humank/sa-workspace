# ADR-001: MyAwesomeAirline 混合雲架構綜合評估

## 狀態

提議中

## 決策日期

2025-03-27

## 背景與問題陳述

本ADR主要專注於MyAwesomeAirline混合雲架構的成本分析與評估，作為架構決策的重要依據。

### 業務需求背景

作為航空業者，系統穩定性、數據安全和合規性至關重要，同時需要應對季節性和非預期的流量波動。MyAwesomeAirline正在規劃混合雲轉型，將訂位系統和行李追蹤系統遷移至AWS雲端，同時保留客戶管理系統在本地資料中心(IDC)。企業需要全面了解此架構的成本模型和長期投資回報，以確保決策的財務合理性。


### 現有環境

目前所有系統均部署在本地IDC，每年支付固定的硬體維護、許可證、電力和冷卻等成本。當前IDC成本模型為資本支出(CAPEX)主導，缺乏彈性擴充能力，且在處理季節性需求高峰時需預留大量閒置資源。

- 本地IDC網段使用172.168.0.0/16
- 客戶管理系統、訂位系統和行李追蹤系統均部署在本地環境
- 安全性主要依賴傳統網絡安全模型，包括防火牆、IDS/IPS系統和傳統訪問控制

### 解決方案目標

1. 建立清晰的混合雲架構成本模型
2. 評估遷移到AWS的當前和長期成本效益
3. 識別成本優化機會
4. 提供決策參考以平衡技術、業務和財務考量
5. 確保地端與雲端安全互通，數據延遲控制在30ms以內
6. 實施符合航空業規範的數據安全控制與合規性要求
7. 確保容器化工作負載的安全性與隔離性

## AWS混合雲架構成本分析

### 詳細成本試算表

#### 計算資源成本

| AWS服務 | 規格 | 單價 | 數量 | 月成本 | 年成本 | 成本優化策略 |
|---------|------|------|------|---------|---------|--------------|
| Amazon EKS | 標準控制平面 | $0.10/小時 | 2 (主要+備援) | $146.00 | $1,752.00 | 共享EKS叢集 |
| EKS Worker節點 | m5.2xlarge<br>(8 vCPU, 32GB RAM) | $0.384/小時 | 6 節點 | $1,658.88 | $19,906.56 | 使用Spot實例，預計節省50-70% |
| 自動擴展節點 | m5.2xlarge | $0.384/小時 | 平均2節點<br>(高峰期) | $552.96 | $6,635.52 | 實施智能擴展策略，基於歷史模式預測 |
| 災難恢復節點 | m5.large | $0.096/小時 | 2 節點 | $138.24 | $1,658.88 | 考慮僅在DR演練和實際災難時擴展 |
| **計算小計** | | | | **$2,496.08** | **$29,952.96** | 通過Savings Plans可節省~25% |

#### 資料庫成本

| AWS服務 | 規格 | 單價 | 數量 | 月成本 | 年成本 | 成本優化策略 |
|---------|------|------|------|---------|---------|--------------|
| Amazon Aurora (MySQL) | r6g.2xlarge<br>(多可用區) | $1.91/小時 | 1主實例 | $1,383.04 | $16,596.48 | 評估Aurora無服務器v2自動擴展 |
| Aurora讀取節點 | r6g.xlarge | $0.95/小時 | 1節點 | $687.60 | $8,251.20 | 根據讀取負載優化實例規格 |
| Aurora儲存 | 標準 | $0.10/GB-月 | 500GB | $50.00 | $600.00 | 實施資料生命週期管理，歸檔冷資料 |
| Aurora I/O | 標準 | $0.20/百萬請求 | 5000萬請求 | $10.00 | $120.00 | 優化查詢和索引設計 |
| Aurora備份 | 標準 | $0.021/GB-月 | 1000GB | $21.00 | $252.00 | 優化備份保留政策 |
| 災難恢復複本 | r6g.xlarge | $0.95/小時 | 1節點 | $687.60 | $8,251.20 | 考慮運行更小的實例規格 |
| **資料庫小計** | | | | **$2,839.24** | **$34,070.88** | 通過保留實例可節省~30% |

#### 網路與連接成本

| AWS服務 | 規格 | 單價 | 數量 | 月成本 | 年成本 | 成本優化策略 |
|---------|------|------|------|---------|---------|--------------|
| Direct Connect | 1Gbps專用連接 | $0.30/小時/連接 | 2連接 | $432.00 | $5,184.00 | 評估頻寬使用率，確認是否需要雙1Gbps |
| Transit Gateway | 標準 | $0.05/小時/連接 | 4連接 | $144.00 | $1,728.00 | 合併VPC連接需求 |
| VPN連接 (備援) | 標準 | $0.05/小時/連接 | 2連接 | $72.00 | $864.00 | 作為備援，正常情況下保持最小化使用 |
| 資料傳輸 (IDC到AWS) | 標準 | $0.02/GB | 5TB/月 | $100.00 | $1,200.00 | 優化資料同步頻率和壓縮 |
| 資料傳輸 (AWS到IDC) | 標準 | $0.02/GB<br>降低DX價格 | 2TB/月 | $40.00 | $480.00 | 實施本地資料快取策略 |
| 跨區域資料傳輸 | 標準 | $0.02/GB | 3TB/月 | $60.00 | $720.00 | 使用Aurora全局資料庫減少手動複製 |
| 公網資料輸出 | 標準 | 分層定價<br>平均$0.08/GB | 10TB/月 | $800.00 | $9,600.00 | 實施CloudFront緩存，降低直接輸出 |
| **網路小計** | | | | **$1,648.00** | **$19,776.00** | 通過優化資料流可節省~20% |

#### 儲存成本

| AWS服務 | 規格 | 單價 | 數量 | 月成本 | 年成本 | 成本優化策略 |
|---------|------|------|------|---------|---------|--------------|
| EBS儲存 (gp3) | 標準 | $0.08/GB-月 | 1200GB | $96.00 | $1,152.00 | 定期評估使用率，刪除未使用卷 |
| EBS快照 | 標準 | $0.05/GB-月 | 2000GB | $100.00 | $1,200.00 | 實施生命週期政策，自動刪除舊快照 |
| S3 標準存儲 | 標準 | $0.023/GB-月 | 5000GB | $115.00 | $1,380.00 | 實施S3生命週期政策，分層儲存 |
| S3 不頻繁訪問 | 標準 | $0.0125/GB-月 | 10000GB | $125.00 | $1,500.00 | 自動遷移冷資料至更低成本的層級 |
| S3 Glacier | 標準 | $0.004/GB-月 | 20000GB | $80.00 | $960.00 | 評估長期封存需求 |
| **儲存小計** | | | | **$516.00** | **$6,192.00** | 通過分層儲存可節省~25% |

#### 其他服務成本

| AWS服務 | 規格 | 單價 | 數量 | 月成本 | 年成本 | 成本優化策略 |
|---------|------|------|------|---------|---------|--------------|
| CloudWatch | 標準 | $0.30/指標/月 | 500指標 | $150.00 | $1,800.00 | 優化監控粒度和保留期 |
| Route 53 | 標準 | $0.50/託管區域/月 | 10託管區域 | $5.00 | $60.00 | 合併相關DNS區域 |
| AWS WAF | 標準 | $5/ACL/月<br>+$1/規則/月 | 2 ACL<br>20規則 | $30.00 | $360.00 | 定期審查規則的有效性 |
| AWS Shield Advanced | 標準 | $3,000/月 | 1 | $3,000.00 | $36,000.00 | 評估是否所有資源都需要高級保護 |
| AWS Config | 標準 | $0.003/配置項/月 | 5000配置項 | $15.00 | $180.00 | 限制範圍到關鍵合規區域 |
| Systems Manager | 標準 | 大多數功能免費 | - | $0.00 | $0.00 | 充分利用免費服務 |
| **其他服務小計** | | | | **$3,200.00** | **$38,400.00** | 通過服務選擇優化可節省~15% |

#### 成本總覽與比較

| 成本類別 | 月成本 | 年成本 | 優化後年成本 | 潛在年度節省 |
|---------|---------|---------|--------------|------------|
| 計算資源 | $2,496.08 | $29,952.96 | $22,464.72 | $7,488.24 (25%) |
| 資料庫 | $2,839.24 | $34,070.88 | $23,849.62 | $10,221.26 (30%) |
| 網路與連接 | $1,648.00 | $19,776.00 | $15,820.80 | $3,955.20 (20%) |
| 儲存 | $516.00 | $6,192.00 | $4,644.00 | $1,548.00 (25%) |
| 其他服務 | $3,200.00 | $38,400.00 | $32,640.00 | $5,760.00 (15%) |
| **總計** | **$10,699.32** | **$128,391.84** | **$99,419.14** | **$28,972.70 (23%)** |

### 與現有本地IDC成本比較

| 成本類別 | 當前本地年成本 | 混合雲年成本 | 差異 |
|---------|--------------|------------|------|
| 硬體與基礎設施 | $180,000.00 | $89,419.14 | -$90,580.86 |
| 許可證與維護 | $65,000.00 | $10,000.00 | -$55,000.00 |
| 人力資源 | $210,000.00 | $190,000.00 | -$20,000.00 |
| 電力與設施 | $45,000.00 | $20,000.00 | -$25,000.00 |
| **總計** | **$500,000.00** | **$309,419.14** | **-$190,580.86 (38%)** |

### 成本效益分析

#### 五年TCO比較
```
$2,500,000 |                                                      
           |                                                      
$2,000,000 |  #######                                             
           |  #     #  #######                                    
$1,500,000 |  #     #  #     #  #######                           
           |  #     #  #     #  #     #  #######                  
$1,000,000 |  #     #  #     #  #     #  #     #  #######         
           |  #  A  #  #  A  #  #  A  #  #  A  #  #  A  #         
  $500,000 |  #     #  #     #  #     #  #     #  #     #         
           |  #######  #  B  #  #  B  #  #  B  #  #  B  #         
        $0 |           #######  #######  #######  #######         
             第1年     第2年     第3年     第4年     第5年     
           
A = 本地IDC成本   B = 混合雲架構成本
```

#### ROI分析
- 初始投資：$150,000 (包含遷移、培訓和初始設置)
- 年度節省：$190,580.86
- 預計回收期：9.5個月
- 5年ROI：536%

### 成本最佳化策略

#### 短期策略 (0-6個月)
1. **計算資源優化**：
   - 實施自動擴展，根據實際負載調整資源
   - 評估Spot實例適用性，對非關鍵工作負載實施
   - 購買Compute Savings Plans，承諾使用量以獲取折扣

2. **儲存優化**：
   - 實施數據生命週期政策，自動將冷數據遷移到低成本存儲層
   - 定期審計並清理未使用的EBS卷和快照
   - 配置存儲指標，識別過度配置的資源

#### 中期策略 (6-18個月)
1. **數據庫優化**：
   - 評估Aurora無服務器v2，實現真正按使用量付費
   - 優化查詢性能，減少I/O成本
   - 實施數據分層策略，將歷史數據存儲在S3中

2. **網絡成本控制**：
   - 審計Direct Connect使用率，優化帶寬配置
   - 實施本地數據緩存策略，減少跨網絡數據傳輸
   - 配置CloudFront，優化公網數據分發

#### 長期策略 (18+個月)
1. **架構現代化**：
   - 評估無服務器架構對適用工作負載的適用性
   - 持續容器化應用，提高資源使用效率
   - 探索更深層次的自動化，減少運維成本

2. **合同優化**：
   - 基於實際使用數據，重新評估預留實例和Savings Plans
   - 與AWS談判企業協議，爭取額外折扣
   - 探索AWS Marketplace節省機會

## 決策

基於詳細的成本分析，混合雲架構方案具有明顯的成本效益和投資回報。初始投資可在不到一年內收回，長期將顯著降低IT運營成本，同時提高系統彈性和服務能力。

## 後果

### 正面後果

* 每年節省約19萬美元(38%)的總體IT運營成本
* 從資本支出(CAPEX)轉向運營支出(OPEX)模式，提高財務靈活性
* 可實現按需擴展，避免過度配置資源
* 降低硬體更新和維護成本

### 負面後果

* 需要投入初始遷移成本和人員培訓
* 雲成本需要持續監控和優化，否則可能超出預算
* 雲服務定價模型複雜，需要專業知識進行管理

### 風險與緩解

| 風險 | 可能性 | 影響 | 緩解策略 |
|------|-------|------|---------|
| 超出預算的雲支出 | 中 | 高 | 實施預算警報，定期成本審查，應用使用限制 |
| 隱藏成本意識不足 | 高 | 中 | 完善成本歸因模型，建立團隊成本意識培訓 |
| 雲服務價格變動 | 中 | 中 | 使用保留實例和Savings Plans鎖定價格 |
| 架構無法達到預期效率 | 中 | 高 | 分階段遷移，定期評估和優化 |

## 實施計劃

### 階段性實施步驟

1. 建立詳細的雲成本模型和跟踪機制
2. 實施初始成本優化策略，包括標記、監控和治理
3. 分階段遷移工作負載，從非關鍵系統開始
4. 實施自動化成本管理工具和流程
5. 定期審查和優化雲資源使用

### 關鍵里程碑

* 雲成本治理框架：2025年4月
* 初始工作負載遷移完成：2025年6月
* 第一次成本優化評估：2025年9月
* 完全遷移完成：2025年12月
* 首次年度TCO評估：2026年3月

### 驗證指標

* 每月雲支出vs預算比較
* 資源使用效率指標 (CPU/內存使用率)
* 基於每用戶/每交易的成本指標
* 與本地環境成本基線的比較
* ROI實現進度跟踪

## 參與者

* 財務總監，財務評估
* IT架構師，技術評估
* 雲運維團隊，實施評估
* 業務部門代表，業務需求驗證
